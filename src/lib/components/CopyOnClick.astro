---
const { text, trailer } = Astro.props as { text: string; trailer: string };
---

<span class="container">
  <button class="copy-button" data-clipboard-text={text}>
    <slot>
      {text}
    </slot>
  </button>{trailer}
  <span
    style={{ "--fly-in-duration": "120ms", "--fly-in-y": "10px" }}
    class="tooltip tooltip-hidden fly-in"
  >
    Copied to clipboard!
  </span>
</span>

<script>
  import ClipboardJS from "clipboard";

  let tooltipTimeout: ReturnType<typeof setTimeout>;

  document.querySelectorAll("button.copy-button").forEach((button) => {
    new ClipboardJS(button);

    button.addEventListener("click", () => {
      const tooltip = button.nextElementSibling as HTMLElement;
      tooltip.classList.remove("tooltip-hidden");

      clearTimeout(tooltipTimeout);

      tooltipTimeout = setTimeout(() => {
        tooltip.classList.add("fade-out");
      }, 1200);

      tooltip.addEventListener(
        "transitionend",
        () => {
          tooltip.classList.remove("fade-out");
          tooltip.classList.add("tooltip-hidden");
        },
        false,
      );
    });
  });
</script>

<style>
  .container {
    position: relative;
    display: inline-flex;
    justify-content: center;
  }

  button {
    padding: 0;

    font-weight: 500;

    background: none;
    border: none;
    color: var(--text-primary);

    cursor: pointer;

    text-decoration: underline;
    text-decoration-color: var(--blue);
    text-decoration-thickness: 2px;
    text-decoration-skip-ink: none;

    transition: color text-decoration-color;
    transition-duration: var(--transition-blink);
  }

  button:hover {
    text-decoration-color: var(--blue-weak);
  }

  .fade-out {
    transition: opacity 60ms linear;
    opacity: 0;
  }

  .tooltip {
    position: absolute;
    bottom: 115%;

    padding: 4px 20px;

    user-select: none;

    border-radius: 4px;

    background-color: var(--text);
    color: var(--background);

    font-size: 0.875rem;
    line-height: 1.25rem;
    text-align: center;

    transition-property: opacity;
  }

  :global(.tooltip-hidden) {
    display: none;
  }
</style>
